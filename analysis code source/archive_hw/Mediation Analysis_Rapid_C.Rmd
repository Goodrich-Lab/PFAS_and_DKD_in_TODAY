---
title: 'Mediation Analysis NGAL'
subtitle: ""
author: "Hongxu Wang"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{css, echo=FALSE}
pre {
max-height: 200px;
overflow-: auto;
}

```


```{r setup, include=FALSE, echo=FALSE}
options(knitr.table.format = "html")
knitr::opts_chunk$set(echo = TRUE)
source(here::here("!libraries.R"))
source(here::here("!directories.R"))
source(here::here("!load_clean_data.R"))
source(here::here("LUCIDusM in Parallel Sankey fxn Plotly.R"))
source(here::here("lucid_parallel.R"))
```

## Data Summary
```{r summary, cache.comments=FALSE, warning=FALSE, message=FALSE}
exposure_name <- c("met_histidine", "met_hydroxyphenyllactic_acid")

pfas_c <- c("pfas_pfda", "pfas_pfhpa", "pfas_pfna", "pfas_pfuna", "pfas_pfoa")
pfas_s <- c("pfas_pfhps", "pfas_pfhxs", "pfas_pfos")

pfas_all <- c(pfas_c, pfas_s)

outcome <- c("rapid", "seq.2836.68")

data_analysis <- full_data %>%
  mutate_at(.vars = c(pfas_all, outcome),
            .funs = ~ scale(.) %>% as.vector(.)) %>%
  mutate_at(.vars = c(met_names, pfas_all),
            .funs = list(high = ~if_else(. > jag2::qntle_fxn(., 0.9), 
                                           1,
                                           0))) 
met_name_cat <- paste0(met_names, "_high")

pfas_name_cat <- paste0(pfas_all, "_high")

pfas_c_cat <-  paste0(pfas_c, "_high")
pfas_s_cat <-  paste0(pfas_s, "_high")
```

## Association of histidine and Proximal tubule biomakers (NGAL)
* NGAL: seq.2836.68
```{r linear}
result1 <- epiomics::owas(df = data_analysis, 
                          var = "seq.2836.68", 
                          omics = met_name_cat,
                          var_exposure_or_outcome = "outcome",
                          conf_int = TRUE) 
result2 <- epiomics::owas(df = data_analysis, 
                          var = "rapid", 
                          omics = met_name_cat,
                          var_exposure_or_outcome = "outcome",
                          conf_int = TRUE) 
```

## Mediation analysis - isoleucine-PFAS-NGAL
```{r mediation analysis1,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid",
                          exposure = "met_isoleucine_high",
                          mediator = pfas_name_cat,
                          # basec = covariates,
                          EMint = FALSE,
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic",
                           "linear", "linear","linear"),
                          yreg = "linear",
                          astar = 0, a = 1,
                          mval = list(0,0,0,0,0,0,0,0),
                          estimation = "imputation",
                          inference = "bootstrap",
                          nboot = 100)
```

```{r result1}
summary(mediation_result)
```

## Mediation analysis - isoleucine-PFCAs-NGAL
```{r mediation analysis2,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_isoleucine_high", 
                          mediator = pfas_c_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result2}
summary(mediation_result)
```

## Mediation analysis - isoleucine-PFSAs-NGAL
```{r mediation analysis3,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_isoleucine_high", 
                          mediator = pfas_s_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```


```{r result3}
summary(mediation_result)
```

## Mediation analysis - pyruvic_acid-PFAS-NGAL
```{r mediation analysis4,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_pyruvic_acid_high", 
                          mediator = pfas_name_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result4}
summary(mediation_result)
```

## Mediation analysis - pyruvic_acid-PFCAs-NGAL
```{r mediation analysis5,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_pyruvic_acid_high", 
                          mediator = pfas_c_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result5}
summary(mediation_result)
```

## Mediation analysis - pyruvic_acid-PFSAs-NGAL
```{r mediation analysis6,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_pyruvic_acid_high", 
                          mediator = pfas_s_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result6}
summary(mediation_result)
```


## Mediation analysis - methionine-PFAS-NGAL
```{r mediation analysis7,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine_high", 
                          mediator = pfas_name_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result7}
summary(mediation_result)
```

## Mediation analysis - methionine-PFCAs-NGAL
```{r mediation analysis8,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine_high", 
                          mediator = pfas_c_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result8}
summary(mediation_result)
```

## Mediation analysis - methionine-PFSAs-NGAL
```{r mediation analysis9,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine_high", 
                          mediator = pfas_s_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result9}
summary(mediation_result)
```

## Mediation analysis - phenylalanine-PFAS-NGAL
```{r mediation analysis10,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_phenylalanine_high", 
                          mediator = pfas_name_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result10}
summary(mediation_result)
```

## Mediation analysis - phenylalanine-PFCAs-NGAL
```{r mediation analysis11,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_phenylalanine_high", 
                          mediator = pfas_c_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result11}
summary(mediation_result)
```

## Mediation analysis - phenylalanine-PFSAs-NGAL
```{r mediation analysis12,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_phenylalanine_high", 
                          mediator = pfas_s_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result12}
summary(mediation_result)
```


## Mediation analysis - gamma_aminobutyric_acid-PFAS-NGAL
```{r mediation analysis13,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_gamma_aminobutyric_acid_high", 
                          mediator = pfas_name_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result13}
summary(mediation_result)
```

## Mediation analysis - gamma_aminobutyric_acid-PFCAs-NGAL
```{r mediation analysis14,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_gamma_aminobutyric_acid_high", 
                          mediator = pfas_c_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic", "logistic", "logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result14}
summary(mediation_result)
```

## Mediation analysis - gamma_aminobutyric_acid-PFSAs-NGAL
```{r mediation analysis15,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_gamma_aminobutyric_acid_high", 
                          mediator = pfas_s_cat, 
                          # basec = covariates,
                          EMint = FALSE, 
                          mreg =
                      list("logistic", "logistic","logistic"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result15}
summary(mediation_result)
```
