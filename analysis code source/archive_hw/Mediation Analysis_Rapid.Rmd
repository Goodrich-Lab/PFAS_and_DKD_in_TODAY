---
title: 'Mediation Analysis Rapid'
subtitle: ""
author: "Hongxu Wang"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{css, echo=FALSE}
pre {
max-height: 200px;
overflow-: auto;
}

```


```{r setup, include=FALSE, echo=FALSE}
options(knitr.table.format = "html")
knitr::opts_chunk$set(echo = TRUE)
source(here::here("!libraries.R"))
source(here::here("!directories.R"))
source(here::here("!load_clean_data.R"))
source(here::here("LUCIDusM in Parallel Sankey fxn Plotly.R"))
source(here::here("lucid_parallel.R"))
```

## Data Summary
```{r summary, cache.comments=FALSE, warning=FALSE, message=FALSE}
exposure_name <- c("met_histidine", "met_hydroxyphenyllactic_acid")

pfas_c <- c("pfas_pfda", "pfas_pfhpa", "pfas_pfna", "pfas_pfuna", "pfas_pfoa")
pfas_s <- c("pfas_pfhps", "pfas_pfhxs", "pfas_pfos")

pfas_all <- c(pfas_c, pfas_s)

outcome <- c("rapid", "rapid")

data_analysis <- full_data %>%
  mutate_at(.vars = c(pfas_all, outcome),
            .funs = ~scale(.) %>% as.vector())
```

## Association of histidine and Proximal tubule biomakers (NGAL)
* NGAL: rapid
```{r linear}
result1 <- epiomics::owas(df = data_analysis, 
                          var = "seq.2836.68", 
                          omics = met_names,
                          var_exposure_or_outcome = "outcome",
                          conf_int = TRUE) 
result2 <- epiomics::owas(df = data_analysis, 
                          var = "rapid", 
                          omics = met_names,
                          var_exposure_or_outcome = "outcome",
                          conf_int = TRUE) 
```

## Mediation analysis - tyrosine-PFAS-rapid
```{r mediation analysis1,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid",
                          exposure = "met_tyrosine",
                          mediator = pfas_all,
                          # basec = covariates,
                          EMint = TRUE,
                          mreg =
                      list("linear", "linear","linear", "linear", "linear",
                           "linear", "linear","linear"),
                          yreg = "linear",
                          astar = 0, a = 1,
                          mval = list(0,0,0,0,0,0,0,0),
                          estimation = "imputation",
                          inference = "bootstrap",
                          nboot = 100)
```

```{r result1}
summary(mediation_result)
```

## Mediation analysis - tyrosine-PFCAs-rapid
```{r mediation analysis2,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_tyrosine", 
                          mediator = pfas_c, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result2}
summary(mediation_result)
```

## Mediation analysis - tyrosine-PFSAs-rapid
```{r mediation analysis3,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_tyrosine", 
                          mediator = pfas_s, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```


```{r result3}
summary(mediation_result)
```

## Mediation analysis - cystine-PFAS-rapid
```{r mediation analysis4,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_cystine", 
                          mediator = pfas_all, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result4}
summary(mediation_result)
```

## Mediation analysis - cystine-PFCAs-rapid
```{r mediation analysis5,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_cystine", 
                          mediator = pfas_c, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result5}
summary(mediation_result)
```

## Mediation analysis - cystine-PFSAs-rapid
```{r mediation analysis6,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_cystine", 
                          mediator = pfas_s, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result6}
summary(mediation_result)
```


## Mediation analysis - methionine-PFAS-rapid
```{r mediation analysis7,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine", 
                          mediator = pfas_all, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result7}
summary(mediation_result)
```

## Mediation analysis - Methionine-PFCAs-rapid
```{r mediation analysis8,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine", 
                          mediator = pfas_c, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result8}
summary(mediation_result)
```

## Mediation analysis - Methionine-PFSAs-rapid
```{r mediation analysis9,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_methionine", 
                          mediator = pfas_s, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result9}
summary(mediation_result)
```

## Mediation analysis - Histidine-PFAS-NGAL
```{r mediation analysis10,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_histidine", 
                          mediator = pfas_all, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear",
                           "linear", "linear","linear"), 
                          yreg = "linear", 
                          # astar = 0, a = 1, 
                          mval = list(0,0,0,0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result10}
summary(mediation_result)
```

## Mediation analysis - Histidine-PFCAs-NGAL
```{r mediation analysis11,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_histidine", 
                          mediator = pfas_c, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear", "linear", "linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)

```

```{r result11}
summary(mediation_result)
```

## Mediation analysis - Histidine-PFSAs-NGAL
```{r mediation analysis12,results='hide',warning=FALSE}
mediation_result <- CMAverse::cmest(data_analysis, outcome ="rapid" , 
                          exposure = "met_histidine", 
                          mediator = pfas_s, 
                          # basec = covariates,
                          EMint = TRUE, 
                          mreg =
                      list("linear", "linear","linear"), 
                          yreg = "linear", 
                          astar = 0, a = 1, 
                          mval = list(0,0,0), 
                          estimation = "imputation",
                          inference = "bootstrap", 
                          nboot = 100)
```

```{r result12}
summary(mediation_result)
```